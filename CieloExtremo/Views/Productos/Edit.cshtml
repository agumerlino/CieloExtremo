@model CieloExtremo.Models.Producto

@{
    ViewData["Title"] = "Edit";
}

<div class="text-center">
    <h1 class="display-4">Editar producto</h1>
</div>

<div class="row justify-content-center">
    <div class="col-md-4">
        <form asp-action="Edit" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="Id" />
            <!-- Nombre -->
            <div class="form-group">
                <label asp-for="nombre" class="control-label"></label>
                <input asp-for="nombre" class="form-control" />
                <span asp-validation-for="nombre" class="text-danger"></span>
            </div>

            <!-- Descripción -->
            <div class="form-group">
                <label asp-for="descripcion" class="control-label"></label>
                <textarea asp-for="descripcion" class="form-control" rows="5" placeholder="Ingrese la descripción..."></textarea>
                <span asp-validation-for="descripcion" class="text-danger"></span>
            </div>

            <!-- Precio -->
            <div class="form-group">
                <label asp-for="precio" class="control-label"></label>
                <div class="input-group">
                    <input asp-for="precio" class="form-control" />
                    <div class="input-group-append">
                        <select class="form-control" name="moneda">
                            <option value="U$D">U$D</option>
                            <option value="AR$">AR$</option>
                        </select>
                    </div>
                </div>
                <span asp-validation-for="precio" class="text-danger"></span>
            </div>

            <!-- Categoría -->
            <div class="form-group">
                <label asp-for="categoria" class="control-label"></label>
                <select id="categoria" asp-for="categoria" class="form-control">
                    <option value="PARACAIDISMO">PARACAIDISMO</option>
                    <option value="PARAPENTE">PARAPENTE</option>
                    <option value="AERONAUTICOS">ACCESORIOS AERONAUTICOS</option>
                    <option value="OTROS">OTROS</option>
                </select>
                <span asp-validation-for="categoria" class="text-danger"></span>
            </div>

            <!-- Subcategoría -->
            <div class="form-group" id="subcategoriaContainer">
                <label asp-for="subcategoria" class="control-label"></label>
                <select id="subcategoria" asp-for="subcategoria" class="form-control">
                    <!-- Opciones serán mostradas dinámicamente -->
                </select>
                <span asp-validation-for="subcategoria" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="telefonoVendedor" class="control-label"> Telefono del vendedor</label>
                <input asp-for="telefonoVendedor" class="form-control" />
                <span asp-validation-for="telefonoVendedor" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="mailVendedor" class="control-label">Mail del vendedor</label>
                <input asp-for="mailVendedor" class="form-control" />
                <span asp-validation-for="mailVendedor" class="text-danger"></span>
            </div>

            <!-- Fotos del producto -->
            <!-- Foto 1 -->
            <div class="form-group">
                <label class="control-label">Foto 1:</label>

                @if (!string.IsNullOrEmpty(Model.foto1))
                {
                    <div>
                        <img id="previewFoto1" src="@Url.Content("~/img/Productos/" + Model.foto1)" alt="Foto 1" class="img-thumbnail" style="max-width: 100px;" />
                    </div>
                }
                <input asp-for="foto1" id="foto1Input" type="file" class="form-control mt-2" accept="image/*" onchange="updateImagePreview(this, 'previewFoto1')" />
                <span asp-validation-for="foto1" class="text-danger"></span>
                <input type="hidden" id="foto1Current" name="foto1Current" value="@Model.foto1" />
            </div>

            <!-- Foto 2 -->
            <div class="form-group">
                <label class="control-label">Foto 2:</label>

                @if (!string.IsNullOrEmpty(Model.foto2))
                {
                    <div>
                        <img id="previewFoto2" src="@Url.Content("~/img/Productos/" + Model.foto2)" alt="Foto 2" class="img-thumbnail" style="max-width: 100px;" />
                    </div>
                }
                <input asp-for="foto2" id="foto2Input" type="file" class="form-control mt-2" accept="image/*" onchange="updateImagePreview(this, 'previewFoto2')" />
                <span asp-validation-for="foto2" class="text-danger"></span>
                <input type="hidden" id="foto2Current" name="foto2Current" value="@Model.foto2" />
            </div>

            <!-- Foto 3 -->
            <div class="form-group">
                <label class="control-label">Foto 3:</label>

                @if (!string.IsNullOrEmpty(Model.foto3))
                {
                    <div>
                        <img id="previewFoto3" src="@Url.Content("~/img/Productos/" + Model.foto3)" alt="Foto 3" class="img-thumbnail" style="max-width: 100px;" />
                    </div>
                }
                <input asp-for="foto3" id="foto3Input" type="file" class="form-control mt-2" accept="image/*" onchange="updateImagePreview(this, 'previewFoto3')" />
                <span asp-validation-for="foto3" class="text-danger"></span>
                <input type="hidden" id="foto3Current" name="foto3Current" value="@Model.foto3" />
            </div>

            <!-- Foto 4 -->
            <div class="form-group">
                <label class="control-label">Foto 4:</label>

                @if (!string.IsNullOrEmpty(Model.foto4))
                {
                    <div>
                        <img id="previewFoto4" src="@Url.Content("~/img/Productos/" + Model.foto4)" alt="Foto 4" class="img-thumbnail" style="max-width: 100px;" />
                    </div>
                }
                <input asp-for="foto4" id="foto4Input" type="file" class="form-control mt-2" accept="image/*" onchange="updateImagePreview(this, 'previewFoto4')" />
                <span asp-validation-for="foto4" class="text-danger"></span>
                <input type="hidden" id="foto4Current" name="foto4Current" value="@Model.foto4" />
            </div>

            <!-- Foto 5 -->
            <div class="form-group">
                <label class="control-label">Foto 5:</label>

                @if (!string.IsNullOrEmpty(Model.foto5))
                {
                    <div>
                        <img id="previewFoto5" src="@Url.Content("~/img/Productos/" + Model.foto5)" alt="Foto 5" class="img-thumbnail" style="max-width: 100px;" />
                    </div>
                }
                <input asp-for="foto5" id="foto5Input" type="file" class="form-control mt-2" accept="image/*" onchange="updateImagePreview(this, 'previewFoto5')" />
                <span asp-validation-for="foto5" class="text-danger"></span>
                <input type="hidden" id="foto5Current" name="foto5Current" value="@Model.foto5" />
            </div>

            <!-- Foto 6 -->
            <div class="form-group">
                <label class="control-label">Foto 6:</label>

                @if (!string.IsNullOrEmpty(Model.foto6))
                {
                    <div>
                        <img id="previewFoto6" src="@Url.Content("~/img/Productos/" + Model.foto6)" alt="Foto 6" class="img-thumbnail" style="max-width: 100px;" />
                    </div>
                }
                <input asp-for="foto6" id="foto6Input" type="file" class="form-control mt-2" accept="image/*" onchange="updateImagePreview(this, 'previewFoto6')" />
                <span asp-validation-for="foto6" class="text-danger"></span>
                <input type="hidden" id="foto6Current" name="foto6Current" value="@Model.foto6" />
            </div>

            <!-- Destacar -->
            <div class="form-group">
                <div class="form-check">
                    <input asp-for="destacar" class="form-check-input" type="checkbox" />
                    <label class="form-check-label" asp-for="destacar">Destacar</label>
                </div>
                <span asp-validation-for="destacar" class="text-danger"></span>
            </div>

            <!-- Subir archivo -->
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Guardar</button>
                <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            // Selecciona los elementos del DOM necesarios
            var categoriaSelect = document.getElementById('categoria');
            var subcategoriaSelect = document.getElementById('subcategoria');
            var subcategoriaContainer = document.getElementById('subcategoriaContainer');

            // Define las opciones de subcategoría por categoría
            var opcionesPorCategoria = {
                'PARACAIDISMO': ['Arnes-Velas', 'Cascos', 'Altimetros', 'Ropa'],
                'PARAPENTE': ['Arnes-Velas', 'Accesorios', 'Ropa'],
                'AERONAUTICOS': ['Accesorios', 'Ropa'],
                'OTROS': ['Camaras', 'Ropa']
            };

            // Función para actualizar las subcategorías según la categoría seleccionada
            function actualizarSubcategorias() {
                var categoriaSeleccionada = categoriaSelect.value;
                var opciones = opcionesPorCategoria[categoriaSeleccionada] || [];

                // Limpia las opciones anteriores
                subcategoriaSelect.innerHTML = '';

                // Añade las nuevas opciones
                opciones.forEach(function (opcion) {
                    var option = document.createElement('option');
                    option.textContent = opcion;
                    option.value = opcion;
                    subcategoriaSelect.appendChild(option);
                });

                // Selecciona la subcategoría actual del modelo
                subcategoriaSelect.value = '@Model.subcategoria';

                // Muestra u oculta el contenedor de subcategorías
                subcategoriaContainer.style.display = opciones.length > 0 ? 'block' : 'none';
            }

            // Función para actualizar la vista previa de la imagen
            function updateImagePreview(inputId, previewId) {
                var input = document.getElementById(inputId);
                var preview = document.getElementById(previewId);

                input.addEventListener('change', function () {
                    var file = input.files[0];
                    if (file) {
                        var reader = new FileReader();

                        reader.onload = function (e) {
                            preview.src = e.target.result;
                            preview.style.display = 'block'; // Muestra la miniatura
                        };

                        reader.readAsDataURL(file);
                    } else {
                        preview.style.display = 'none'; // Oculta la miniatura si no hay archivo
                    }
                });
            }

            // Asigna el evento de cambio al selector de categoría
            categoriaSelect.addEventListener('change', actualizarSubcategorias);

            // Inicializa la actualización de subcategorías y las vistas previas de las imágenes
            actualizarSubcategorias();

            // Inicializa las vistas previas para los campos de carga de archivos
            updateImagePreview('foto1Input', 'previewFoto1');
            updateImagePreview('foto2Input', 'previewFoto2');
            updateImagePreview('foto3Input', 'previewFoto3');
            updateImagePreview('foto4Input', 'previewFoto4');
            updateImagePreview('foto5Input', 'previewFoto5');
            updateImagePreview('foto6Input', 'previewFoto6');
        });
    </script>
}
